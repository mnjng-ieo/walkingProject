<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/defaultLayout}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>마이페이지</title>

<!-- Popper.js -->
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<!-- 자바스크립트 -->
<script type="text/javascript" src="/js/common/mypage.js"></script>
<script type="text/javascript" src="/js/common/mypageCourse.js"></script> 
<!-- css -->
<link rel="stylesheet" href="/css/common/mypageCourse.css">
<link rel="stylesheet" href="/css/common/mypage.css">


   <script>

   </script>

</head>
<body>
<th:block layout:fragment="Content">

<!-- 사이드바(오른쪽) -->
<section class ="sidebar">
    <div class ="container d-flex justify-content-end mt-5">
        <button class="btn btn-success px-4 fs-5" type="button" 
        data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" 
        aria-controls="offcanvasRight">나의 정보</button>
    </div>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title p-2" id="offcanvasRightLabel">Sidebar </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
         <div class="flex-shrink-0 p-3 bg-white" style="width: 280px;">
              <a href="/main"
                  class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
                  <span class="fs-3 fw-semibold">W.A.Y
                    <img src="/images/common/logo_img.png" class="logo p-2 mb-3"></img>
                  </span>
              </a>
              <ul class="list-unstyled ps-0">

                  <li class="mb-1">
                      <button
                          class="fs-4 btn btn-toggle align-items-center rounded collapsed"
                          data-bs-toggle="collapse" data-bs-target="#account-collapse"
                          aria-expanded="false">나의 정보</button>
                      <div class="collapse show mx-4" id="account-collapse">
                          <ul class="fs-5 btn-toggle-nav list-unstyled fw-normal pb-5 small">
                              <li class="my-1"><a th:href="@{/main/mypage/userpage}" class="link-dark rounded">정보
                                      조회</a></li>
                              <li class="my-1"><a th:href="@{/logout}" class="link-dark rounded">로그아웃</a></li>
                          </ul>
                      </div>
                  </li>

                  <li class="border-top my-5"></li>
                  <li class="mb-1">
                      <button
                          class="fs-4 btn btn-toggle align-items-center rounded collapsed"
                          data-bs-toggle="collapse" data-bs-target="#home-collapse"
                          aria-expanded="true">나의 기록</button>
                      <div class="collapse show mx-4" id="home-collapse">
                          <ul class="fs-5 btn-toggle-nav list-unstyled fw-normal pb-1 small">
                              <li class="my-1"><a th:href="@{/main/mypage-course}" class="link-dark rounded">내가 좋아한 길</a></li>
                          </ul>
                      </div>
                  </li>
              </ul>
          </div>        
      </div>
    </div>
</section><!-- 사이드바 끝 -->

    <div class="container">
        <h1 class="my-5 text-center formTitle">
            <a th:href="@{/main/mypage}" class="link-dark rounded">My Page</a>
        </h1>
        
        <!-- 유저 소개 조회 -->
        <div class="formBox" id="getUserBox">
            <div class="needs-validation" th:object="${user}">
                <input type="hidden" name="userId" th:value="${user.userId}">
                <div class="m-3 d-flex justify-content-center userBox">
                    <div class="user-imgWithBtnBox">
                    <div class="user-imgBox">
                        <!-- src="/images/defaultUserImage.png"-->
                        <div class="user-imgBox_imageborder">
                            <img class="user-imgBox_image" 
                                alt="유저 프로필 사진"
                             th:src="${imagePath}? 
                             ${imagePath}: '/images/defaultUserImage.png'" />
                         </div>
                    </div>
                    </div>
                    <div class="m-3 user-infoBox">
                        <div class="row user-nicknameBox" style="margin-top: 10px;">
                            <div class="col-md-6">
                                <span th:text="*{userNickname}"
                                    class="userNickname fixedName">내 닉네임</span>
                            </div>
                            <div class="col-md-6">
                                <!--  -->
                                <button type="submit" id="modifyBtn" 
                                        style="margin-top: -1px;"
                                        class="userBox_btn">내소개 수정</button>
                            </div>
                        </div>
                        <div class="row user-descBox">
                            <span th:text="*{userDescription}"
                                    class="userDesc fixedUserDesc"
                                    id="userDescription" name="userDescription"
                                    rows="4"
                                    style="white-space : pre-wrap;">나의 소개글 한 마디를 입력해주세요!</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 유저 소개 수정폼 style="display: none;"-->
        <div class="formBox" id="modifyUserBox" style="display: none;">
            <form class="needs-validation" id="formData" 
                method="post" action="/main/mypage" th:object="${user}"
                enctype="multipart/form-data">
                <input type="hidden" name="userId" th:value="${user.userId}">
                <div class="m-3 d-flex justify-content-center userBox">
                    <div class="user-imgWithBtnBox">
                        <div class="user-imgBox">
                            <!-- 파일 업로드를 위한 숨겨진 input 요소. 
                                 업로드 버튼을 클릭하면 input을 클릭한 것처럼 작동하여 파일 선택 다이얼로그를 열게 됨 -->
                             <input type="file" name="file" id="imageUploadInput" 
                                    style="display:none;" accept="image/*">
                             <input type="hidden" name="ifNewImageExists"
                                   id="ifNewImageExists" value="0">
                            <div class="user-imgBox_imageborder">
                               <img class="user-imgBox_image" 
                                   id="user-imgBox_image"
                                   alt="유저 프로필 사진"
                                th:src="${imagePath}? 
                                ${imagePath}: '/images/defaultUserImage.png'" />
                            </div>
                            
                        </div>
                        <button type="button" class="imageUploadButton"
                                onclick="uploadImage()"
                                ><i class="fa-solid fa-plus"></i></button>
                        <button type="button" class="imageDeleteButton"
                               onclick="deleteImage()"
                               ><i class="fa-solid fa-circle-xmark"></i></button>

                    </div>
                    <div class="m-3 user-infoBox">
                        <div class="row user-nicknameBox">
                            <div class="col-md-6">
                                <input type="text" th:field="*{userNickname}"
                                    class="userNickname" />
                            </div>
                            <div class="col-md-6">
                                <button type="submit" id="modifySuccessBtn" 
                                        class="userBox_btn"
                                    >수정 완료</button>
                            </div>
                        </div>
                        <div class="row user-descBox">
                            <textarea th:field="*{userDescription}"
                                    class="userDesc userDescEdit"
                                    id="userDescription" name="userDescription"
                                    rows="4" placeholder="소개글 한 마디를 입력해주세요!"></textarea>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
        <!-- 내가 좋아요 한 산책로 -->
    <div id="searchResults">
    <!-- 산책로 목록 카드 ; 검색 결과를 표시할 영역-->
    <div class="container course-lists" >
    <h2 class = "my-3 mt-5 course-title" >내가 <i class="fa-solid fa-heart" style="color: #ff0000;"></i> 한 산책로 모아보기</h2>     
    <p class = "my-3 px-4 myCount">
       산책로 수 : <span th:text="${myCourses.totalElements}"></span></p>

        <div class="row px-4">
            <p th:if="${myCourses.totalElements == 0}" 
                  class= "noResult mx-5 mt-5 text-center fs-5">좋아요 한 산책로가 없습니다.</p>
            <div class="col-4" th:each="item : ${myCourses}">
                <div class="card course-list"
                     th:onclick="'redirectToCourseDetails(' + ${item.courseId} + ')'">
                    <!-- 예정 : Course에 추가할 coursImg. 현재 default만 설정 -->
                    <img class="card-img-top course-list_imgBox" 
                         src="/images/defaultCourseImg.png" alt="산책로 사진" />
                    <div class="card-body course-list_textbox">
                        <div class="course-list_titlebox">
                            <div class="row course-list_title">
                                <!-- 산책로 이름 - 큰이름과 작은이름이 서로 같으면 큰 이름만 출력 되도록 
                                     하려면 th:if="${item.wlkCoursNm} != ${item.wlkCoursFlagNm}" 붙이기 -->
                                <h5 class="col-10 card-title course-list_big-title" 
                                    th:text="${item.wlkCoursFlagNm}">
                                    산책로 큰이름</h5>
                                <!-- 산책로 난이도 -->
                                <p class="col-3 rounded-pill badge text-center course-list_level"
                                   th:classappend="${item.coursLevelNm == '매우쉬움' ? ' bg-primary' : 
                                                     item.coursLevelNm == '쉬움' ? ' bg-info' : 
                                                     item.coursLevelNm == '보통' ? ' bg-success' : 
                                                     item.coursLevelNm == '어려움' ? ' bg-warning' : 
                                                     item.coursLevelNm == '매우어려움' ? ' bg-danger' : ''}"
                                   th:text="${item.coursLevelNm}">난이도</p>
                            </div>
                            <div>
                                <!-- 산책로 큰이름과 작은 이름이 같은 경우 고려할 때
                                <h5 class="card-text"
                                    th:if="${item.wlkCoursNm} == ${item.wlkCoursFlagNm}"
                                    >&nbsp;</h5> -->
                                <h3 class="card-text course-list_small-title" 
                                    th:text="${item.wlkCoursNm}">산책로 작은이름</h3>
                            </div>
                        </div>
                        
                        <!-- 지역 -->
                        <p class="card-text course-list_region" 
                           th:text="${item.signguCn}">지역</p>
                        <!-- "코스거리" | "소요시간"시간 분 소요 -->
                        <p class="card-text course-list_distance">
                            <span th:text="${item.coursDetailLtCn}">총코스거리</span>km |  
                            <span th:text="${#dates.format(item.coursTimeCn, 'H시간 mm분 소요')}">
                             소요 시간</span>
                        </p>
                        <!-- 산책로 설명 : 일정 길이 넘어가면 ... 로 축약되도록 -->
                        <p class="card-text course-list_aditDc" 
                           th:text="${#strings.length(item.aditDc) &gt; 70 ? 
                                    #strings.substring(item.aditDc, 0, 70) + '...' 
                                    : item.aditDc}">산책로 설명
                        </p>
                        <!-- 예정 : 좋아요 수 / 언급 수 / 댓글 수 -->
                        <p class="card-text">
                           <img class="heart-icon"
                                 src="/images/common/heart-click.png" alt="좋아요" />
                           <span th:text="${item.likeCnt}">좋아요 수</span>개 
                           <span style="margin-right:15px;"></span>
                           <i class="fa-regular fa-comment-dots"></i>
                           <span th:text="${item.commentCnt}">댓글 수</span>개
                           <span style="margin-right:15px;"></span>
                           <i class="fa-regular fa-pen-to-square"></i>
                           <span th:text="${item.mentionCnt}">언급 수</span>개
                           <span style="margin-right:120px;"></span>
                           <i class="fa-regular fa-eye "></i>
                           <span th:text="${item.coursViewCount}">조회수</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 페이지네이션 기능 -->
    <div class="pageInfo_wrap" id="pagination">
        <!--pagination-sm 추가하면 작아지고, pagination-lg 추가하면 커진다 -->
        <ul class="pagination pagination-sm
                   justify-content-center">
           <li class="page-item" id="pagePrev"
               th:classappend="${currentPage == 0} ? 'disabled' : ''">
               <!-- 링크 클릭할 때 해당 링크의 url로 이동하는 기본 동작 막기 위해 사용
                    자바스크립트가 없는 상황에서는 아무 것도 일어나지 않게끔 한다. -->
               <!-- th:onclick="'loadPage(\''+${currentPage - 1}+'\')'" -->
               <a class="page-link arrow" 
                  href="javascript:void(0);"
                  th:onclick="'loadPage(' + (${currentPage - 1}) + ')'">
                <i class="fa-solid fa-chevron-left"></i></a>
           </li>
           <th:block th:each="page : ${#numbers.sequence(pageStart, pageEnd)}">
               <li th:if="${page == (currentPage+1)}" 
                   class="page-item active">
                   <a class="page-link" 
                   href="javascript:void(0);"
                   th:onclick="'loadPage(' + (${page - 1}) + ')'">[[${page}]]</a>
               </li>
               <li th:unless="${page == (currentPage+1)}" 
                   class="page-item">
                   <a class="page-link" 
                   href="javascript:void(0);"
                   th:onclick="'loadPage(' + (${page - 1}) + ')'">[[${page}]]</a>
               </li>
           </th:block>
           <li class="page-item" id="pageNext"
               th:classappend="${currentPage == lastPage} ? 'disabled' : ''">
               <a class="page-link arrow" 
               href="javascript:void(0);"
               th:onclick="'loadPage(' + (${currentPage + 1}) + ')'">
                <i class="fa-solid fa-chevron-right"></i></a>
           </li>
        </ul>
    </div>
    </div>
  
    

     	
</th:block>
</body>
</html>