<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/defaultLayout}"
	  layout:fragment="Content">
<head>
<meta charset="UTF-8">
	<title>홈페이지</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<style>
	.fa-bounce {
		--fa-animation-iteration-count: 1;
		--fa-bounce-height: -5px;
		--fa-animation-timing: cubic-bezier(0.1, -0.6, 0.2, 0);
	    --fa-bounce-jump-scale-x : 1;
	    --fa-bounce-jump-scale-y : 1.05;
	    --fa-bounce-land-scale-x : 1;
	    --fa-bounce-land-scale-y : 1;
	    --fa-bounce-start-scale-x : 1.05;
	}
    .wrap {
	    position: absolute; 
	    left: 16px; bottom: 40px;
	    width: 250px; height: auto;
	    margin-left: -144px;
	    text-align: left; overflow: hidden;
	    font-size: 12px; 
	    line-height: 1.5;}
    .wrap * {
    	padding: 0;margin: 0;}
    .wrap .info {
	    height: auto;
	    margin-bottom: 12px;
	    border-radius: 15px; 
 	    border-bottom: 2px solid #ccc;
	    border-right: 1px solid #ccc;
	    overflow: hidden;
	    background: #EEF2E6;}
    .wrap .info:nth-child(1) {
	    border: 0;
/* 	    box-shadow: 0px 1px 2px #888; */}
    .info .title {
	    padding: 5px 0px 30px 15px;
	    height: 30px; 
	    line-height: 27px;
	    background: #3D8361;
	    color: white;
	    font-size: 14px; 
	    font-weight: bold;}
	.info .title .icon{
		--fa-animation-iteration-count: 1;
		--fa-bounce-height: -4px;
		--fa-animation-timing: cubic-bezier(0.1, -0.6, 0.2, 0);
	    font-size: 18px; 
		margin-right: 3px;
	}
    .info .close {
	    position: absolute;
	    top: 4px; right: 8px;
	    width: 17px;height: 17px;}
    .info .close:hover {cursor: pointer;}
    .info .body {
    	position: relative;
    	overflow: hidden;}
    .info .desc {
    	position: relative;
    	margin: 12px 15px 12px 15px;
    	color : #1C6758;
    	height: auto;}
    .desc .ellipsis {
    	overflow: hidden;
    	text-overflow: ellipsis;
    	white-space: nowrap;

    	}
    .desc .textsm {
    	overflow: hidden;
    	font-size: 12px;
    	color : #1C6758;
    	margin-top: -2px;}
    .desc .now{
    	color: #7FB77E;
    	font-weight: bolder;}
    .desc a{
    	color: inherit;
    	text-decoration-line: none;
    }
    .desc .icon{
    	font-size: 3px;
    	margin-right: 8px;
    	color : #1C6758;}
    .desc .moreOpenContent{
    	display: none;
    }
   	.desc .moreClose{
	    font-weight: bold;
   		margin-top: 10px;
    	text-align: center;
    	cursor: pointer;
   	}
   	.desc .moreOpen{	
	    font-weight: bold;
   		margin-top: 5px;
    	text-align: center;
    	cursor: pointer;
   	}
    .info:after {
    	content: '';
    	position: absolute;
    	margin-left: -9px;
    	margin-bottom: -12px;
    	left: 50%; bottom: 0;
    	width: 18px; height: 24px;
    	border-top: 12px solid #EEF2E6;
    	border-bottom: 12px solid transparent;
    	border-left: 12px solid transparent;
    	border-right: 12px solid transparent;
    	/* background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')*/}
    .info .link {color: white;}
</style>
</head>
<body>
	
<div class="container" >
	<h1>mapTest.html</h1>
	<div id="map" style="width:600px;height:500px;"></div>
<input type="hidden" id="courseId" th:value="${course.courseId}">
<input type="hidden" id="flagName" th:value="${course.wlkCoursFlagNm}">
<input type="hidden" id="courseName" th:value="${course.wlkCoursNm}">
<input type="hidden" id="courseLat" th:value="${course.coursSpotLa}">
<input type="hidden" id="courseLng" th:value="${course.coursSpotLo}">
<input type="hidden" id="courseAddr" th:value="${course.signguCn}">
<input type="hidden" id="courseLength" th:value="${course.coursDetailLtCn}">
<input type="hidden" id="courseTime" th:value="${#dates.format(course.coursTimeCn, 'H시간 mm분 소요')}">
<div>
	<th:block th:each="other : ${courseNames}">
		<input type="hidden" class="otherCourseName" th:value="${other.wlkCoursNm}">
		<input type="hidden" class="otherCourseId" th:value="${other.courseId}">
	</th:block>
</div>
</div>
	


<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f5041361e9b1c4d5fd6a9c27cfadb45e"></script>
<script>
	function getValue(valueName){
		return document.getElementById(valueName).value
	}
	
	let courseId = getValue("courseId")
	let flagName = getValue("flagName")
	let courseName = getValue("courseName")
	let courseLat = getValue("courseLat")
	let courseLng = getValue("courseLng")
	let courseAddr = getValue("courseAddr")
	let courseLength = getValue("courseLength")
	let courseTime = getValue("courseTime")
	let otherCourseName = document.getElementsByClassName("otherCourseName")
	let otherCourseId = document.getElementsByClassName("otherCourseId")
	
	let mapContainer = document.getElementById('map'), // 지도의 중심좌표
    mapOption = { 
        center: new kakao.maps.LatLng(parseFloat(courseLat)+0.002, courseLng), // 지도의 중심좌표
        level: 5 // 지도의 확대 레벨
    }; 

	let map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
	
	// 지도에 마커를 표시합니다 
	let marker = new kakao.maps.Marker({
	    map: map, 
	    position: new kakao.maps.LatLng(courseLat, courseLng)
	});
	
	// 커스텀 오버레이에 표시할 컨텐츠 입니다
	// 커스텀 오버레이는 아래와 같이 사용자가 자유롭게 컨텐츠를 구성하고 이벤트를 제어할 수 있기 때문에
	// 별도의 이벤트 메소드를 제공하지 않습니다 
	let content = '<div class="wrap fa-bounce">' + 
	            '    <div class="info">' + 
	            '        <div class="title ellipsis">' +
	            '			<i class="icon fa-solid  fa-bounce fa-person-walking fa-lg"></i> ' + 
	            '            <span class="fa-bounce">' + flagName + '</span>' +
	            '            <div class="close " onclick="closeOverlay()" title="닫기"><i class="fa-solid fa-x"></i></div>' + 
	            '        </div>' + 
	            '        <div class="body">' + 
	            '            <div class="desc">'
	for(let i = 0; i < Math.min(5, otherCourseName.length); i++){
		content += '                <div class="textsm ellipsis'
		if(courseId == otherCourseId[i].value){
			content += ' now'
		}
		content += '"><a href="/course/' + otherCourseId[i].value + '">'
					+ '<i class="fa-solid fa-arrow-up-right-from-square icon fa-xs"></i> ' + otherCourseName[i].value + ' </a></div>'
	}
	if(otherCourseName.length > 5){
		content += '                <div class="moreClose" id="moreClose"><i class="fa-solid fa-angle-down"></i> 더보기</div>'
		content += '                <div class="moreOpenContent" id="moreOpenContent">'
			for(let i = 5; i < otherCourseName.length; i++){
				content += '                <div class="textsm ellipsis'
					if(courseId == otherCourseId[i].value){
						content += ' now'
					}
					content += '"><a href="/course/' + otherCourseId[i].value + '">'
					+'<i class="fa-solid fa-arrow-up-right-from-square icon fa-xs"></i> ' + otherCourseName[i].value + '</a></div>'
				
			}
		content += '                <div class="moreOpen" id="moreOpen"><i class="fa-solid fa-angle-up"></i> 더보기</div>'
		content += '                </div>' 
	}          
	content +=  '            </div>' + 
	            '        </div>' + 
	            '    </div>' +    
	            '</div>';
	            
/* 	let moreCloseContent =''
	for(let i = 0; i < 5; i++){
		moreCloseContent += '                <div class="jibun ellipsis"><a href="/course/' + otherCourseId[i].value + '">' + otherCourseName[i].value + ' <i class="fa-solid fa-arrow-up-right-from-square icon"></i></a></div>'
	}
	moreCloseContent = '                <div class="moreClose"><i class="fa-solid fa-angle-down"></i> 더보기</div>'
	
	let moreOpenContent = ''
	for(let i = 0; i < otherCourseName.length; i++){
		moreOpenContent += '                <div class="jibun ellipsis"><a href="/course/' + otherCourseId[i].value + '">' + otherCourseName[i].value + ' <i class="fa-solid fa-arrow-up-right-from-square icon"></i></a></div>'
	}
	moreOpenContent = '                <div class="moreOpen"><i class="fa-solid fa-angle-up"></i> 더보기</div>' */
		

	// 마커 위에 커스텀오버레이를 표시합니다
	// 마커를 중심으로 커스텀 오버레이를 표시하기위해 CSS를 이용해 위치를 설정했습니다
	let overlay = new kakao.maps.CustomOverlay({
	    content: content,
	    map: map,
	    position: marker.getPosition()       
	});

	// 마커를 클릭했을 때 커스텀 오버레이를 표시합니다
	kakao.maps.event.addListener(marker, 'click', function() {
	    overlay.setMap(map);
	});
	let moreOpenContent = document.getElementById("moreOpenContent")
	let moreClose = document.getElementById("moreClose")
	let moreOpen = document.getElementById("moreOpen")
	moreClose.addEventListener('click', function(){
		moreOpenContent.style.display ="block"
		moreClose.style.display="none"
	})
	moreOpen.addEventListener('click', function(){
		moreOpenContent.style.display ="none"
		moreClose.style.display="block"
	})
	// 커스텀 오버레이를 닫기 위해 호출되는 함수입니다 
	function closeOverlay() {
	    overlay.setMap(null);     
	}
</script>
</body>
</html>